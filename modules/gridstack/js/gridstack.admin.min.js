!function(t,a,i,e,r){"use strict";a.behaviors.gridstackAdmin={grids:null,data:{},breakpoints:{},windowWidth:0,opts:{},serializedData:[],form:".form--gridstack--ui",storedData:{},options:[],defaultGrids:[{x:0,y:0,width:2,height:2},{x:3,y:1,width:1,height:2},{x:4,y:1,width:1,height:1},{x:2,y:3,width:3,height:1},{x:1,y:4,width:1,height:1},{x:1,y:3,width:1,height:1},{x:2,y:4,width:1,height:1},{x:2,y:5,width:1,height:1}],attach:function(a){var s=this,d=i.gridstack||{},n={itemClass:"gridstack__box",handle:".box__content",alwaysShowResizeHandle:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),resizable:{handles:"e, se, s, sw, w"}},o=t(s.form,a);t(".gridstack--admin",o).once("gridstack-admin").each(function(){var a,i=this,e=t(i),o=null,c=e.data("responsiveWidth"),l=e.data("currentColumn")||12;s.data=e.data("config")||{},c&&(e.css({maxWidth:c}),12>l&&(s.data.width=l)),s.opts=t.extend({},d,n,s.data),s.storedData=e.data("previewGrids")||{},s.serializedData=s.storedData||s.defaultGrids,a=e.gridstack(s.opts),s.grids=e.data("gridstack"),s.breakpoints=e.data("breakpoints")||null,s.grids.setGridWidth(l),o=r.GridStackUI.Utils.sort(s.serializeData(e)),t("> .gridstack__box",i).each(function(){var a=t(this);s.cleanUpBox(a),s.setDimensions(a),s.selectImage(a,o)}),e.on("added",function(a,e){var r=t("> .gridstack__box:visible",i).last(),d=r.index()+1;r.addClass("box--"+d).attr("data-index",d),s.cleanUpBox(r),s.setDimensions(r)}),a.on("resizestop",function(a){var i=t(a.target);s.setDimensions(i)}),e.removeClass("grid-stack-12")}),t(".button--main",o).once("gridstack-button").each(function(){t(this).off("click.gsbutton.main").on("click.gsbutton.main",function(a){if(a.target===this){var i=t(this);switch(i.data("message")){case"save":s.saveGrid(a);break;case"add":s.addBox(a);break;case"clear":s.clearGrid(a);break;case"load":var e=s.currentGrid(a),r=i.closest(".gridstack-preview").find(".gridstack");s.loadGrid(r,e)}return!1}})}),o.once("gridstack-form").each(function(){var a=t(this);a.find(".form-select--column").each(function(){t(this).change(function(a){if(a.target===this){var i=t(this),e=t(i.data("target"));if(e.length){var r=e.data("gridstack"),s=i.val()?i.val():e.data("currentColumn");r.setGridWidth(s)}}}).change()}),a.find(".form-text--width").each(function(){t(this).on("keyup",e.debounce(function(a){if(a.target===this){var i=t(this),e=t(i.data("target"));if(e.length){var r=i.val()?i.val():e.data("responsiveWidth");e.css({width:r,maxWidth:r})}}},200))}),a.off("click.gsbutton.remove").on("click.gsbutton.remove",".button--remove",function(t){return t.target===this?(s.removeBox(t),!1):void 0}),a.on("submit",function(){t('.button--gridstack[data-message="save"]').each(function(){t(this).click()})})})},setDimensions:function(a){var i=a.data("_gridstack_node");e.isUndefined(i)||e.isNull(i.width)||t(".box__dimension",a).html(i.width+"x"+i.height)},box:function(a){return t(t("#gridstack-box-template").html()).clone()},cleanUpBox:function(a){a.find(".form-select--image-style").removeClass("form-select--original").removeAttr("id"),a.closest(".gridstack").hasClass("gridstack--main")||t(".button--remove",a).remove()},serializeData:function(a){var i=this,e=a.data("storage"),r=t(".gridstack--main").data("previewGrids"),s=t('[data-drupal-selector="'+e+'"]'),d=""!==s.val()&&"[]"!==s.val()?JSON.parse(s.val()):"",n=d||r||i.defaultGrids;return n},loadGrid:function(a,i){var s=this;i.removeAll();var d=r.GridStackUI.Utils.sort(s.serializeData(a),-1);return e.each(d,function(a,e){t(".button--remove",s.box(e)).data("message","remove"),i.addWidget(t(s.box(e)),a.x,a.y,a.width,a.height,!0)},this),!1},saveGrid:function(a){var i=this,r=t(a.currentTarget),s=r.data("storage"),d=r.closest(".gridstack-preview").find(".gridstack"),n=null;return i.serializedData=e.map(t("> .gridstack__box:visible",d),function(a,i){var e=t(a).data("_gridstack_node"),r=t(".form-select--image-style",a);return n={x:e.x,y:e.y,width:e.width,height:e.height,image_style:r.val()}},this),t('[data-drupal-selector="'+s+'"]').val(e.isNull(n)?"":JSON.stringify(i.serializedData)),!1},selectImage:function(a,i){var e=a.data("index")-1,r=t(".form-select--image-style",a);r.on("change.gschange.img",function(a){if(a.target===this){var r=t(this),s="undefined"!=typeof i[e]&&"undefined"!=typeof i[e].image_style?i[e].image_style:"",d=r.data("imageStyle")?r.data("imageStyle"):s,n=t(this).val()||d;r.val(n).find("option:selected").prop("selected",!0).siblings("option").prop("selected",!1)}}).change()},clearGrid:function(a){var i=this,e=i.currentGrid(a),r=t(a.currentTarget).closest(".gridstack-preview");return e&&(e.removeAll(),t("html, body").stop().animate({scrollTop:r.offset().top-120},100)),!1},addBox:function(a){var i=this;return t(".gridstack--admin").each(function(){var a=t(this),e=t("> .gridstack__box:visible",a).last().data("index"),r=a.data("gridstack");r.addWidget(t(i.box(e)),0,0,Math.floor(1+3*Math.random()),Math.floor(1+3*Math.random()),!0)}),!1},removeBox:function(a){var i=t(a.currentTarget),r=i.closest(".gridstack__box").data("index");return t(".gridstack--admin").each(function(){var a=t(this),i=a.data("gridstack"),s=t('.gridstack__box[data-index="'+r+'"]'),d=s.data("_gridstack_node");e.isUndefined(d)||e.isNull(d._id)||i.removeWidget(d.el)}),!1},currentGrid:function(a,i){var e=t(a.currentTarget),r=e.closest(".gridstack-preview").find(".gridstack"),s=i?i:t(r),d=s.data("gridstack");return d}}}(jQuery,Drupal,drupalSettings,_,this);
