/**
 * gridstack.js 0.2.5-dev
 * http://troolee.github.io/gridstack.js/
 * (c) 2014-2016 Pavel Reznikov
 * gridstack.js may be freely distributed under the MIT license.
 * @preserve
 *
 * A modified version to remove jQuery UI till decoupled,
 * suitable only for static grid option as normally seen at static frontend.
 */

!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","underscore"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("underscore")):t(jQuery,_)}(function(t,e){"use strict";var i=window,n={isIntercepted:function(t,e){return!(t.x+t.width<=e.x||e.x+e.width<=t.x||t.y+t.height<=e.y||e.y+e.height<=t.y)},sort:function(t,i,n){return n=n||e.chain(t).map(function(t){return t.x+t.width}).max().value(),i=-1!==i?1:-1,e.sortBy(t,function(t){return i*(t.x+t.y*n)})},createStylesheet:function(t){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("data-gs-style-id",t),e.styleSheet?e.styleSheet.cssText="":e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet},removeStylesheet:function(e){t("STYLE[data-gs-style-id="+e+"]").remove()},insertCSSRule:function(t,e,i,n){"function"==typeof t.insertRule?t.insertRule(e+"{"+i+"}",n):"function"==typeof t.addRule&&t.addRule(e,i,n)},toBool:function(t){return"boolean"==typeof t?t:"string"==typeof t?(t=t.toLowerCase(),!(""===t||"no"===t||"false"===t||"0"===t)):Boolean(t)},_collisionNodeCheck:function(t){return t!==this.node&&n.isIntercepted(t,this.nn)},_didCollide:function(t){return n.isIntercepted({x:this.n.x,y:this.newY,width:this.n.width,height:this.n.height},t)},_isAddNodeIntercepted:function(t){return n.isIntercepted({x:this.x,y:this.y,width:this.node.width,height:this.node.height},t)},parseHeight:function(t){var i=t,n="px";if(i&&e.isString(i)){var s=i.match(/^([0-9]*\.[0-9]+|[0-9]+)(px|em|rem|vh|vw)?$/);if(!s)throw new Error("Invalid height");n=s[2]||"px",i=parseFloat(s[1])}return{height:i,unit:n}}},s=0,o=function(t,e,i,n,s){this.width=t,this["float"]=i||!1,this.height=n||0,this.nodes=s||[],this.onchange=e||function(){},this._updateCounter=0,this._float=this["float"],this._addedNodes=[],this._removedNodes=[]};o.prototype.batchUpdate=function(){this._updateCounter=1,this["float"]=!0},o.prototype.commit=function(){0!==this._updateCounter&&(this._updateCounter=0,this["float"]=this._float,this._packNodes(),this._notify())},o.prototype.getNodeDataByDOMEl=function(t){return e.find(this.nodes,function(e){return t.get(0)===e.el.get(0)})},o.prototype._fixCollisions=function(t){this._sortNodes(-1);var i=t,s=Boolean(e.find(this.nodes,function(t){return t.locked}));for(this["float"]||s||(i={x:0,y:t.y,width:this.width,height:t.height});;){var o=e.find(this.nodes,e.bind(n._collisionNodeCheck,{node:t,nn:i}));if("undefined"==typeof o)return;this.moveNode(o,o.x,t.y+t.height,o.width,o.height,!0)}},o.prototype.isAreaEmpty=function(t,i,s,o){var h={x:t||0,y:i||0,width:s||1,height:o||1},a=e.find(this.nodes,e.bind(function(t){return n.isIntercepted(t,h)},this));return null===a||"undefined"==typeof a},o.prototype._sortNodes=function(t){this.nodes=n.sort(this.nodes,t,this.width)},o.prototype._packNodes=function(){this._sortNodes(),this["float"]?e.each(this.nodes,e.bind(function(t,i){if(!t._updating&&"undefined"!=typeof t._origY&&t.y!==t._origY)for(var s=t.y;s>=t._origY;){var o=e.chain(this.nodes).find(e.bind(n._didCollide,{n:t,newY:s})).value();o||(t._dirty=!0,t.y=s),--s}},this)):e.each(this.nodes,e.bind(function(t,i){if(!t.locked)for(;t.y>0;){var s=t.y-1,o=0===i;if(i>0){var h=e.chain(this.nodes).take(i).find(e.bind(n._didCollide,{n:t,newY:s})).value();o="undefined"==typeof h}if(!o)break;t._dirty=t.y!==s,t.y=s}},this))},o.prototype._prepareNode=function(t,i){return t=e.defaults(t||{},{width:1,height:1,x:0,y:0}),t.x=parseInt(""+t.x),t.y=parseInt(""+t.y),t.width=parseInt(""+t.width),t.height=parseInt(""+t.height),t.autoPosition=t.autoPosition||!1,t.noResize=t.noResize||!1,t.noMove=t.noMove||!1,t.width>this.width?t.width=this.width:t.width<1&&(t.width=1),t.height<1&&(t.height=1),t.x<0&&(t.x=0),t.x+t.width>this.width&&(i?t.width=this.width-t.x:t.x=this.width-t.width),t.y<0&&(t.y=0),t},o.prototype._notify=function(){if(!this._updateCounter){var t=Array.prototype.slice.call(arguments,0);t=t.concat(this.getDirtyNodes()),this.onchange(t)}},o.prototype.cleanNodes=function(){this._updateCounter||e.each(this.nodes,function(t){t._dirty=!1})},o.prototype.getDirtyNodes=function(){return e.filter(this.nodes,function(t){return t._dirty})},o.prototype.addNode=function(t,i){if(t=this._prepareNode(t),"undefined"!=typeof t.maxWidth&&(t.width=Math.min(t.width,t.maxWidth)),"undefined"!=typeof t.maxHeight&&(t.height=Math.min(t.height,t.maxHeight)),"undefined"!=typeof t.minWidth&&(t.width=Math.max(t.width,t.minWidth)),"undefined"!=typeof t.minHeight&&(t.height=Math.max(t.height,t.minHeight)),t._id=++s,t._dirty=!0,t.autoPosition){this._sortNodes();for(var o=0;;++o){var h=o%this.width,a=Math.floor(o/this.width);if(!(h+t.width>this.width||e.find(this.nodes,e.bind(n._isAddNodeIntercepted,{x:h,y:a,node:t})))){t.x=h,t.y=a;break}}}return this.nodes.push(t),"undefined"!=typeof i&&i&&this._addedNodes.push(e.clone(t)),this._fixCollisions(t),this._packNodes(),this._notify(),t},o.prototype.moveNode=function(t,e,i,n,s,o){if("number"!=typeof e&&(e=t.x),"number"!=typeof i&&(i=t.y),"number"!=typeof n&&(n=t.width),"number"!=typeof s&&(s=t.height),"undefined"!=typeof t.maxWidth&&(n=Math.min(n,t.maxWidth)),"undefined"!=typeof t.maxHeight&&(s=Math.min(s,t.maxHeight)),"undefined"!=typeof t.minWidth&&(n=Math.max(n,t.minWidth)),"undefined"!=typeof t.minHeight&&(s=Math.max(s,t.minHeight)),t.x===e&&t.y===i&&t.width===n&&t.height===s)return t;var h=t.width!==n;return t._dirty=!0,t.x=e,t.y=i,t.width=n,t.height=s,t=this._prepareNode(t,h),this._fixCollisions(t),o||(this._packNodes(),this._notify()),t},o.prototype.getGridHeight=function(){return e.reduce(this.nodes,function(t,e){return Math.max(t,e.y+e.height)},0)},o.prototype.beginUpdate=function(t){e.each(this.nodes,function(t){t._origY=t.y}),t._updating=!0},o.prototype.endUpdate=function(){e.each(this.nodes,function(t){t._origY=t.y});var t=e.find(this.nodes,function(t){return t._updating});t&&(t._updating=!1)};var h=function(i,n){var s,h,a=this;n=n||{},this.container=t(i),n.itemClass=n.itemClass||"grid-stack-item";var d=this.container.closest("."+n.itemClass).size()>0,r=n.handle?n.handle:"";if(this.opts=e.defaults(n||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,itemClass:"grid-stack-item",placeholderClass:"grid-stack-placeholder",placeholderText:"",handle:".grid-stack-item-content",handleClass:null,cellHeight:60,verticalMargin:20,auto:!0,minWidth:768,"float":!1,staticGrid:!1,_class:"grid-stack-instance-"+(1e4*Math.random()).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||!1,alwaysShowResizeHandle:n.alwaysShowResizeHandle||!1,resizable:e.defaults(n.resizable||{},{autoHide:!n.alwaysShowResizeHandle,handles:"se"}),draggable:e.defaults(n.draggable||{},{handle:(n.handleClass?"."+n.handleClass:r)||".grid-stack-item-content",scroll:!1,appendTo:"body"}),disableDrag:n.disableDrag||!1,disableResize:n.disableResize||!1,rtl:"auto",removable:!1,removeTimeout:2e3}),"auto"===this.opts.rtl&&(this.opts.rtl="rtl"===this.container.css("direction")),this.opts.rtl&&this.container.addClass("grid-stack-rtl"),this.opts.isNested=d,h="auto"===this.opts.cellHeight,h?a.cellHeight(a.cellWidth(),!0):this.cellHeight(this.opts.cellHeight,!0),this.verticalMargin(this.opts.verticalMargin,!0),this.container.addClass(this.opts._class),this._setStaticClass(),d&&this.container.addClass("grid-stack-nested"),this._initStyles(),this.grid=new o(this.opts.width,function(t){var i=0;e.each(t,function(t){null===t._id?t.el.remove():(t.el.attr("data-gs-x",t.x).attr("data-gs-y",t.y).attr("data-gs-width",t.width).attr("data-gs-height",t.height),i=Math.max(i,t.y+t.height))}),a._updateStyles(i+10)},this.opts["float"],this.opts.height),this.opts.auto){var l=[],c=this;this.container.children("."+this.opts.itemClass+":not(."+this.opts.placeholderClass+")").each(function(e,i){i=t(i),l.push({el:i,i:parseInt(i.attr("data-gs-x"))+parseInt(i.attr("data-gs-y"))*c.opts.width})}),e.chain(l).sortBy(function(t){return t.i}).each(function(t){a._prepareElement(t.el)}).value()}this.placeholder=t('<div class="'+this.opts.placeholderClass+" "+this.opts.itemClass+'"><div class="placeholder-content">'+this.opts.placeholderText+"</div></div>").hide(),this._updateContainerHeight(),this._updateHeightsOnResize=e.throttle(function(){a.cellHeight(a.cellWidth(),!1)},100),this.onResizeHandler=function(){if(h&&a._updateHeightsOnResize(),a._isOneColumnMode()){if(s)return;s=!0,a.grid._sortNodes(),e.each(a.grid.nodes,function(t){a.container.append(t.el),a.opts.staticGrid})}else{if(!s)return;if(s=!1,a.opts.staticGrid)return}},t(window).resize(this.onResizeHandler),this.onResizeHandler()};return h.prototype._triggerChangeEvent=function(t){var e=this.grid.getDirtyNodes(),i=!1,n=[];e&&e.length&&(n.push(e),i=!0),(i||t===!0)&&this.container.trigger("change",n)},h.prototype._initStyles=function(){this._stylesId&&n.removeStylesheet(this._stylesId),this._stylesId="gridstack-style-"+(1e5*Math.random()).toFixed(),this._styles=n.createStylesheet(this._stylesId),null!==this._styles&&(this._styles._max=0)},h.prototype._updateStyles=function(t){if(null!==this._styles&&"undefined"!=typeof this._styles){var e,i="."+this.opts._class+" ."+this.opts.itemClass,s=this;if("undefined"==typeof t&&(t=this._styles._max,this._initStyles(),this._updateContainerHeight()),this.opts.cellHeight&&!(0!==this._styles._max&&t<=this._styles._max)&&(e=this.opts.verticalMargin&&this.opts.cellHeightUnit!==this.opts.verticalMarginUnit?function(t,e){return t&&e?"calc("+(s.opts.cellHeight*t+s.opts.cellHeightUnit)+" + "+(s.opts.verticalMargin*e+s.opts.verticalMarginUnit)+")":s.opts.cellHeight*t+s.opts.verticalMargin*e+s.opts.cellHeightUnit}:function(t,e){return s.opts.cellHeight*t+s.opts.verticalMargin*e+s.opts.cellHeightUnit},0===this._styles._max&&n.insertCSSRule(this._styles,i,"min-height: "+e(1,0)+";",0),t>this._styles._max)){for(var o=this._styles._max;t>o;++o)n.insertCSSRule(this._styles,i+'[data-gs-height="'+(o+1)+'"]',"height: "+e(o+1,o)+";",o),n.insertCSSRule(this._styles,i+'[data-gs-min-height="'+(o+1)+'"]',"min-height: "+e(o+1,o)+";",o),n.insertCSSRule(this._styles,i+'[data-gs-max-height="'+(o+1)+'"]',"max-height: "+e(o+1,o)+";",o),n.insertCSSRule(this._styles,i+'[data-gs-y="'+o+'"]',"top: "+e(o,o)+";",o);this._styles._max=t}}},h.prototype._updateContainerHeight=function(){if(!this.grid._updateCounter){var t=this.grid.getGridHeight();this.container.attr("data-gs-current-height",t),this.opts.cellHeight&&(this.opts.verticalMargin?this.opts.cellHeightUnit===this.opts.verticalMarginUnit?this.container.css("height",t*(this.opts.cellHeight+this.opts.verticalMargin)-this.opts.verticalMargin+this.opts.cellHeightUnit):this.container.css("height","calc("+(t*this.opts.cellHeight+this.opts.cellHeightUnit)+" + "+(t*(this.opts.verticalMargin-1)+this.opts.verticalMarginUnit)+")"):this.container.css("height",t*this.opts.cellHeight+this.opts.cellHeightUnit))}},h.prototype._isOneColumnMode=function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=this.opts.minWidth},h.prototype._setupRemovingTimeout=function(e){var i=this,n=t(e).data("_gridstack_node");!n._removeTimeout&&i.opts.removable&&(n._removeTimeout=setTimeout(function(){e.addClass("grid-stack-item-removing"),n._isAboutToRemove=!0},i.opts.removeTimeout))},h.prototype._clearRemovingTimeout=function(e){var i=t(e).data("_gridstack_node");i._removeTimeout&&(clearTimeout(i._removeTimeout),i._removeTimeout=null,e.removeClass("grid-stack-item-removing"),i._isAboutToRemove=!1)},h.prototype._prepareElement=function(e,i){i="undefined"!=typeof i?i:!1;var s=this;e=t(e),e.addClass(this.opts.itemClass);var o=s.grid.addNode({x:e.attr("data-gs-x"),y:e.attr("data-gs-y"),width:e.attr("data-gs-width"),height:e.attr("data-gs-height"),maxWidth:e.attr("data-gs-max-width"),minWidth:e.attr("data-gs-min-width"),maxHeight:e.attr("data-gs-max-height"),minHeight:e.attr("data-gs-min-height"),autoPosition:n.toBool(e.attr("data-gs-auto-position")),noResize:n.toBool(e.attr("data-gs-no-resize")),noMove:n.toBool(e.attr("data-gs-no-move")),locked:n.toBool(e.attr("data-gs-locked")),el:e,id:e.attr("data-gs-id"),_grid:s},i);e.data("_gridstack_node",o),e.attr("data-gs-locked",o.locked?"yes":null)},h.prototype.removeAll=function(t){e.each(this.grid.nodes,e.bind(function(e){this.removeWidget(e.el,t)},this)),this.grid.nodes=[],this._updateContainerHeight()},h.prototype.destroy=function(e){t(window).off("resize",this.onResizeHandler),this.disable(),"undefined"==typeof e||e?this.container.remove():this.removeAll(!1),n.removeStylesheet(this._stylesId),this.grid&&(this.grid=null)},h.prototype.locked=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var s=n.data("_gridstack_node");"undefined"!=typeof s&&null!==s&&(s.locked=i||!1,n.attr("data-gs-locked",s.locked?"yes":null))}),this},h.prototype.maxHeight=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var s=n.data("_gridstack_node");"undefined"!=typeof s&&null!==s&&(isNaN(i)||(s.maxHeight=i||!1,n.attr("data-gs-max-height",i)))}),this},h.prototype.minHeight=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var s=n.data("_gridstack_node");"undefined"!=typeof s&&null!==s&&(isNaN(i)||(s.minHeight=i||!1,n.attr("data-gs-min-height",i)))}),this},h.prototype.maxWidth=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var s=n.data("_gridstack_node");"undefined"!=typeof s&&null!==s&&(isNaN(i)||(s.maxWidth=i||!1,n.attr("data-gs-max-width",i)))}),this},h.prototype.minWidth=function(e,i){return e=t(e),e.each(function(e,n){n=t(n);var s=n.data("_gridstack_node");"undefined"!=typeof s&&null!==s&&(isNaN(i)||(s.minWidth=i||!1,n.attr("data-gs-min-width",i)))}),this},h.prototype._updateElement=function(e,i){e=t(e).first();var n=e.data("_gridstack_node");if("undefined"!=typeof n&&null!==n){var s=this;s.grid.cleanNodes(),s.grid.beginUpdate(n),i.call(this,e,n),s._updateContainerHeight(),s._triggerChangeEvent(),s.grid.endUpdate()}},h.prototype.resize=function(t,e,i){this._updateElement(t,function(t,n){e=null!==e&&"undefined"!=typeof e?e:n.width,i=null!==i&&"undefined"!=typeof i?i:n.height,this.grid.moveNode(n,n.x,n.y,e,i)})},h.prototype.move=function(t,e,i){this._updateElement(t,function(t,n){e=null!==e&&"undefined"!=typeof e?e:n.x,i=null!==i&&"undefined"!=typeof i?i:n.y,this.grid.moveNode(n,e,i,n.width,n.height)})},h.prototype.update=function(t,e,i,n,s){this._updateElement(t,function(t,o){e=null!==e&&"undefined"!=typeof e?e:o.x,i=null!==i&&"undefined"!=typeof i?i:o.y,n=null!==n&&"undefined"!=typeof n?n:o.width,s=null!==s&&"undefined"!=typeof s?s:o.height,this.grid.moveNode(o,e,i,n,s)})},h.prototype.verticalMargin=function(t,e){if("undefined"==typeof t)return this.opts.verticalMargin;var i=n.parseHeight(t);(this.opts.verticalMarginUnit!==i.unit||this.opts.height!==i.height)&&(this.opts.verticalMarginUnit=i.unit,this.opts.verticalMargin=i.height,e||this._updateStyles())},h.prototype.cellHeight=function(t,e){if("undefined"==typeof t){if(this.opts.cellHeight)return this.opts.cellHeight;var i=this.container.children("."+this.opts.itemClass).first();return Math.ceil(i.outerHeight()/i.attr("data-gs-height"))}var s=n.parseHeight(t);(this.opts.cellHeightUnit!==s.heightUnit||this.opts.height!==s.height)&&(this.opts.cellHeightUnit=s.unit,this.opts.cellHeight=s.height,e||this._updateStyles())},h.prototype.cellWidth=function(){var t=this.container.children("."+this.opts.itemClass).first();return Math.ceil(t.outerWidth()/parseInt(t.attr("data-gs-width"),10))},h.prototype.getCellFromPixel=function(t,e){var i="undefined"!=typeof e&&e?this.container.offset():this.container.position(),n=t.left-i.left,s=t.top-i.top,o=Math.floor(this.container.width()/this.opts.width),h=Math.floor(this.container.height()/parseInt(this.container.attr("data-gs-current-height")));return{x:Math.floor(n/o),y:Math.floor(s/h)}},h.prototype.batchUpdate=function(){this.grid.batchUpdate()},h.prototype.commit=function(){this.grid.commit(),this._updateContainerHeight()},h.prototype.isAreaEmpty=function(t,e,i,n){return this.grid.isAreaEmpty(t,e,i,n)},h.prototype.setStatic=function(t){this.opts.staticGrid=t===!0,this._setStaticClass()},h.prototype._setStaticClass=function(){var t="grid-stack-static";this.opts.staticGrid===!0?this.container.addClass(t):this.container.removeClass(t)},h.prototype._updateNodeWidths=function(t,e){this.grid._sortNodes(),this.grid.batchUpdate();for(var i={},n=0;n<this.grid.nodes.length;n++)i=this.grid.nodes[n],this.update(i.el,Math.round(i.x*e/t),null,Math.round(i.width*e/t),null);this.grid.commit()},h.prototype.setGridWidth=function(t){this.container.removeClass("grid-stack-"+this.opts.width),this._updateNodeWidths(this.opts.width,t),this.opts.width=t,this.container.addClass("grid-stack-"+t)},i.GridStackUI=h,i.GridStackUI.Utils=n,i.GridStackUI.Engine=o,t.fn.gridstack=function(e){return this.each(function(){var i=t(this);i.data("gridstack")||i.data("gridstack",new h(this,e))})},i.GridStackUI});
